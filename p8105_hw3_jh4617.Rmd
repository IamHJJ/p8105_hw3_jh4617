---
title: "p8105_hw3_jh4617"
author: "Junjie Hu"
date: "2023-10-12"
output: github_document
editor_options: 
  chunk_output_type: inline
---

```{r load data }
library(p8105.datasets)
library(tidyverse)
data("instacart")
```

# Problem 1

```{r echo = FALSE}
instacart

names(instacart)
```

There are `r length(unique(pull(instacart, aisle)))` aisles. The `r mode(pull(instacart, aisle))` aisle is the most items ordered from.

```{r plot item}
instacart |>
  group_by(aisle) |>
  summarize(sum_order_number = sum(order_number)) |>

  filter(sum_order_number > 10000) |>
  arrange(sum_order_number) |>
  ggplot(aes(x = aisle, y = sum_order_number)) +
  geom_boxplot() +
    labs(
    title = "The number of items ordered in each aisle",
    x = "Aisle",
    y = "Number") 
```

```{r}
instacart |>
  group_by(aisle, product_name) |>
  summarize(n_obs = n()) |>
  arrange(aisle, desc(n_obs)) |>
  top_n(3, n_obs)
```

```{r}
instacart |>
  group_by(product_name, order_dow) |>
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |>
  summarize(mean_order_hour_of_day = mean(order_hour_of_day)) |>
  mutate(order_dow = recode(order_dow, "0" = "sunday",
                            "1" = "monday",
                            "2" = "tuesday",
                            "3" = "wednesday",
                            "4" = "thursday",
                            "5" = "friday",
                            "6" = "saturday"))|>
  pivot_wider(
    names_from = order_dow,
    values_from = mean_order_hour_of_day
  )
```

# Problem 2

```{r echo = FALSE}
library(p8105.datasets)
data("brfss_smart2010")

```

data cleaning
```{r}
problem2 = 
  brfss_smart2010 |> 
  janitor::clean_names() |>
  filter(topic == "Overall Health",
         response %in% c("Excellent", "Very Good", "Good", "Fair", "Poor")) |>
    mutate(response = factor(response, levels = c("Poor", "Fair", "Good", "Very Good", "Excellent")))
  
```


2002
```{r}
problem2_2002 =
  problem2 |>
  group_by(locationabbr) |>
  filter(year == "2002") |>
  summarize(n_obs = n_distinct(locationdesc)) |>
  filter(n_obs >= 7)
print(problem2_2002)
```
In 2002, there are `r nrow(problem2_2002)` states were observed at 7 or more locations.


2010
```{r}
problem2_2010 =
  problem2 |>
  group_by(locationabbr) |>
  filter(year == "2010") |>
  summarize(n_obs = n_distinct(locationdesc)) |>
  filter(n_obs >= 7)
print(problem2_2010)
```
In 2010, there are `r nrow(problem2_2010)` states were observed at 7 or more locations. 


```{r}
problem2_ggplot = 
  problem2 |>
  filter(response == "Excellent") |> 
  group_by(locationabbr, year) |>
  summarize(mean_data_value = mean(data_value, na.rm = TRUE)) 

ggplot(data = problem2_ggplot, aes( x = year, y = mean_data_value, group = locationabbr, color = locationabbr)) +
  geom_point() +
  geom_line() +
   labs(x = "Year", 
        y = "Mean Data Value", 
        title = "Mean Data Value for Excellent Response by Year")
```
The highest mean data value is `r max(pull(problem2_ggplot, mean_data_value))` in `r problem2_ggplot |> filter(mean_data_value == "29.46") |> pull(locationabbr)` when `r problem2_ggplot |> filter(mean_data_value == "29.46") |> pull(year)`. The lowest mean data value is `r min(pull(problem2_ggplot, mean_data_value))` in `r problem2_ggplot |> filter(mean_data_value == "11.5") |> pull(locationabbr)` when `r problem2_ggplot |> filter(mean_data_value == "11.5") |> pull(year)`.

```{r}
problem2_ggplot2 = 
  problem2 |>
  group_by(locationabbr, locationdesc, response) |>
  filter(locationabbr == "NY" & year %in% c(2006, 2010)) 
  
ggplot(data = problem2_ggplot2, aes(x = response, y = data_value)) +
  geom_boxplot() +
  facet_grid(~year) + 
  labs( y = "Data Value", 
        title = "The distribution of data value for responses in NY state")

ggplot(data = problem2_ggplot2, aes(x = data_value, fill = response)) +
  geom_density(alpha = .5) +
  facet_grid(~year) + 
  labs( x = "Data Value", 
        y = "probability",
        title = "The distribution of data value for responses in NY state")
```
The mean data value of individuals responded poor health at NY in 2006


# Problem 3

```{r}
library(tidyverse)

covar = 
  read.csv("nhanes_covar.csv", skip = 2) |> 
  janitor::clean_names() |> 
  magrittr::set_colnames(c("seqn","sex","age","bmi","education")) |>
  slice(-2) 

accel = 
  read.csv("nhanes_accel.csv") |> 
  janitor::clean_names() |> 
  mutate(seqn = as.character(seqn))


problem3_join = 
  left_join(covar, accel) |> 
  filter(age > 21) |> 
  drop_na(seqn | sex | age | bmi | education) 

```


